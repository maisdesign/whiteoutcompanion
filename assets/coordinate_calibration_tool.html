<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiteout Survival - Coordinate Calibration Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
            align-items: center;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .facility-selector {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .facility-selector label {
            font-weight: bold;
            font-size: 14px;
        }

        .facility-selector select {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 14px;
            min-width: 150px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .map-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .map-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        #map {
            width: 100%;
            height: auto;
            display: block;
            cursor: crosshair;
        }

        .marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            z-index: 10;
        }

        .marker:hover {
            transform: scale(1.5);
            z-index: 20;
        }

        .marker.construction { background: #3498db; }
        .marker.production { background: #e74c3c; }
        .marker.defense { background: #9b59b6; }
        .marker.gathering { background: #2ecc71; }
        .marker.tech { background: #f39c12; }
        .marker.weapons { background: #34495e; }
        .marker.training { background: #e67e22; }
        .marker.expedition { background: #1abc9c; }
        .marker.stronghold { background: #8e44ad; }
        .marker.fortress { background: #c0392b; }

        .marker-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .marker:hover .marker-label {
            opacity: 1;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .progress-section {
            margin-bottom: 25px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .facility-list {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
        }

        .facility-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .facility-item:last-child {
            border-bottom: none;
        }

        .facility-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .facility-type {
            font-weight: bold;
            color: #4facfe;
        }

        .coordinates {
            font-family: monospace;
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .export-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .code-output {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 10px;
        }

        .status {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }

        .status.info {
            background: rgba(79, 172, 254, 0.2);
            border: 1px solid rgba(79, 172, 254, 0.5);
        }

        .status.success {
            background: rgba(67, 233, 123, 0.2);
            border: 1px solid rgba(67, 233, 123, 0.5);
        }

        .status.warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .sidebar {
                position: static;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Whiteout Survival Coordinate Calibration Tool</h1>
            <p>Click on the map to position facilities exactly where they should be</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <div class="facility-selector">
                    <label for="facility-type">Facility Type:</label>
                    <select id="facility-type">
                        <option value="Construction">üèóÔ∏è Construction</option>
                        <option value="Production">‚öôÔ∏è Production</option>
                        <option value="Defense">üõ°Ô∏è Defense</option>
                        <option value="Gathering">üåæ Gathering</option>
                        <option value="Tech">üî¨ Tech</option>
                        <option value="Weapons">‚öîÔ∏è Weapons</option>
                        <option value="Training">üéØ Training</option>
                        <option value="Expedition">üöÄ Expedition</option>
                        <option value="Stronghold">üè∞ Stronghold</option>
                        <option value="Fortress">üèØ Fortress</option>
                    </select>
                </div>
            </div>

            <div class="control-group">
                <div class="facility-selector">
                    <label for="facility-level">Level:</label>
                    <select id="facility-level">
                        <option value="Lv.1">Lv.1</option>
                        <option value="Lv.2">Lv.2</option>
                        <option value="Lv.3">Lv.3</option>
                        <option value="Lv.4">Lv.4</option>
                        <option value="Lv.5">Lv.5</option>
                    </select>
                </div>
            </div>

            <div class="control-group">
                <button class="btn btn-warning" onclick="undoLast()">‚Ü∂ Undo Last</button>
                <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>
        </div>

        <div class="main-content">
            <div class="map-section">
                <h3>üéØ Click on the map to place facilities</h3>
                <div class="status info" id="current-status">
                    Ready to place: <span id="current-facility">Construction Lv.1</span>
                </div>
                <div class="map-container">
                    <img src="https://bright-starburst-05e046.netlify.app/map.png" 
                         id="map" 
                         alt="Whiteout Survival Map"
                         crossorigin="anonymous">
                </div>
            </div>

            <div class="sidebar">
                <div class="progress-section">
                    <h3>üìä Progress</h3>
                    <div>
                        <span id="placed-count">0</span> facilities placed
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="facility-list">
                    <h4>üìã Placed Facilities</h4>
                    <div id="facility-list-content">
                        <p style="opacity: 0.6; font-style: italic;">No facilities placed yet. Click on the map to start!</p>
                    </div>
                </div>

                <div class="export-section">
                    <h4>üíæ Export</h4>
                    <button class="btn btn-success" onclick="generateCode()" style="width: 100%; margin-bottom: 10px;">
                        üìÑ Generate facilitiesData.js
                    </button>
                    <button class="btn btn-primary" onclick="copyToClipboard()" style="width: 100%; margin-bottom: 10px;">
                        üìã Copy to Clipboard
                    </button>
                    <button class="btn btn-warning" onclick="downloadFile()" style="width: 100%;">
                        üíæ Download File
                    </button>
                </div>
            </div>
        </div>

        <div id="output-section" style="margin-top: 30px; display: none;">
            <h3>üìÑ Generated facilitiesData.js</h3>
            <div class="code-output" id="code-output"></div>
        </div>
    </div>

    <script>
        let facilities = [];
        let totalExpectedFacilities = 100; // Estimate

        // Get map element and set up click handler
        const map = document.getElementById('map');
        const mapContainer = map.parentElement;

        map.addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            
            placeFacility(x, y);
        });

        function placeFacility(x, y) {
            const type = document.getElementById('facility-type').value;
            const level = document.getElementById('facility-level').value;
            
            const facility = {
                Type: type,
                Level: level,
                x: Math.round(x * 100) / 100,
                y: Math.round(y * 100) / 100
            };
            
            facilities.push(facility);
            
            // Create visual marker
            createMarker(facility, facilities.length - 1);
            
            // Update UI
            updateProgress();
            updateFacilityList();
            updateCurrentStatus();
            
            // Auto-increment level or change type
            autoAdvanceFacility();
        }

        function createMarker(facility, index) {
            const marker = document.createElement('div');
            marker.className = `marker ${facility.Type.toLowerCase()}`;
            marker.style.left = `calc(${facility.x}% - 6px)`;
            marker.style.top = `calc(${facility.y}% - 6px)`;
            marker.dataset.index = index;
            
            const label = document.createElement('div');
            label.className = 'marker-label';
            label.textContent = `${facility.Type} ${facility.Level}`;
            marker.appendChild(label);
            
            // Double-click to remove
            marker.addEventListener('dblclick', function(e) {
                e.stopPropagation();
                removeFacility(index);
            });
            
            mapContainer.appendChild(marker);
        }

        function removeFacility(index) {
            facilities.splice(index, 1);
            updateMarkers();
            updateProgress();
            updateFacilityList();
        }

        function updateMarkers() {
            // Remove all markers
            document.querySelectorAll('.marker').forEach(marker => marker.remove());
            
            // Recreate all markers
            facilities.forEach((facility, index) => {
                createMarker(facility, index);
            });
        }

        function undoLast() {
            if (facilities.length > 0) {
                facilities.pop();
                updateMarkers();
                updateProgress();
                updateFacilityList();
                updateCurrentStatus();
            }
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all placed facilities?')) {
                facilities = [];
                updateMarkers();
                updateProgress();
                updateFacilityList();
                updateCurrentStatus();
            }
        }

        function autoAdvanceFacility() {
            const typeSelect = document.getElementById('facility-type');
            const levelSelect = document.getElementById('facility-level');
            
            // Count how many of current type/level we have
            const currentType = typeSelect.value;
            const currentLevel = levelSelect.value;
            const count = facilities.filter(f => 
                f.Type === currentType && f.Level === currentLevel
            ).length;
            
            // Suggest next placement based on typical patterns
            const suggestions = {
                'Construction': { 'Lv.1': 16, 'Lv.3': 8 },
                'Production': { 'Lv.1': 12 },
                'Defense': { 'Lv.2': 12, 'Lv.4': 8 },
                'Gathering': { 'Lv.1': 12 },
                'Tech': { 'Lv.1': 8, 'Lv.3': 4 },
                'Weapons': { 'Lv.2': 8, 'Lv.4': 8 },
                'Training': { 'Lv.2': 12 },
                'Expedition': { 'Lv.3': 4 },
                'Stronghold': { 'Lv.1': 1, 'Lv.2': 1, 'Lv.3': 1, 'Lv.4': 1 },
                'Fortress': { 'Lv.1': 1, 'Lv.2': 1, 'Lv.3': 1, 'Lv.4': 1, 'Lv.5': 1 }
            };
            
            const typesSuggestions = suggestions[currentType];
            if (typesSuggestions && typesSuggestions[currentLevel] && count >= typesSuggestions[currentLevel]) {
                // Move to next level or type
                const currentLevelNum = parseInt(currentLevel.replace('Lv.', ''));
                if (currentLevelNum < 5 && typesSuggestions[`Lv.${currentLevelNum + 1}`]) {
                    levelSelect.value = `Lv.${currentLevelNum + 1}`;
                } else {
                    // Move to next type
                    const types = Array.from(typeSelect.options).map(opt => opt.value);
                    const currentIndex = types.indexOf(currentType);
                    if (currentIndex < types.length - 1) {
                        typeSelect.selectedIndex = currentIndex + 1;
                        levelSelect.value = 'Lv.1';
                    }
                }
            }
        }

        function updateProgress() {
            const placedCount = facilities.length;
            document.getElementById('placed-count').textContent = placedCount;
            
            const percentage = Math.min((placedCount / totalExpectedFacilities) * 100, 100);
            document.getElementById('progress-bar').style.width = percentage + '%';
        }

        function updateFacilityList() {
            const container = document.getElementById('facility-list-content');
            
            if (facilities.length === 0) {
                container.innerHTML = '<p style="opacity: 0.6; font-style: italic;">No facilities placed yet. Click on the map to start!</p>';
                return;
            }
            
            const grouped = {};
            facilities.forEach(facility => {
                const key = `${facility.Type} ${facility.Level}`;
                if (!grouped[key]) grouped[key] = [];
                grouped[key].push(facility);
            });
            
            let html = '';
            Object.entries(grouped).forEach(([key, facilities]) => {
                html += `
                    <div class="facility-item">
                        <span class="facility-type">${key}</span>
                        <span class="coordinates">${facilities.length}x</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateCurrentStatus() {
            const type = document.getElementById('facility-type').value;
            const level = document.getElementById('facility-level').value;
            document.getElementById('current-facility').textContent = `${type} ${level}`;
        }

        function generateCode() {
            if (facilities.length === 0) {
                alert('Please place some facilities first!');
                return;
            }
            
            let code = `// ===== WHITEOUT SURVIVAL FACILITY DATA - CALIBRATED COORDINATES =====
// Generated on ${new Date().toLocaleDateString()} with ${facilities.length} facilities

const facilityData = [
`;
            
            facilities.forEach((facility, index) => {
                code += `  { "Type": "${facility.Type}", "Level": "${facility.Level}", "x": ${facility.x}, "y": ${facility.y} }`;
                if (index < facilities.length - 1) code += ',';
                code += '\n';
            });
            
            code += `];

// Export for use in your app
if (typeof window !== 'undefined') {
  window.facilityData = facilityData;
}

// CommonJS support
if (typeof module !== 'undefined' && module.exports) {
  module.exports = facilityData;
}`;
            
            document.getElementById('code-output').textContent = code;
            document.getElementById('output-section').style.display = 'block';
            
            // Scroll to output
            document.getElementById('output-section').scrollIntoView({ behavior: 'smooth' });
        }

        function copyToClipboard() {
            generateCode();
            const code = document.getElementById('code-output').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('‚úÖ Code copied to clipboard!');
            }).catch(() => {
                alert('‚ùå Failed to copy. Please select and copy manually.');
            });
        }

        function downloadFile() {
            generateCode();
            const code = document.getElementById('code-output').textContent;
            const blob = new Blob([code], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'facilitiesData.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize
        updateCurrentStatus();
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'z' && e.ctrlKey) {
                e.preventDefault();
                undoLast();
            }
        });

        // Update facility type/level change handlers
        document.getElementById('facility-type').addEventListener('change', updateCurrentStatus);
        document.getElementById('facility-level').addEventListener('change', updateCurrentStatus);
    </script>
</body>
</html>
