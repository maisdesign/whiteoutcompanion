const translations = {
  en: {
    // Main interface
    title: "Whiteout Survival Companion",
    alliances: "Alliances",
    allianceName: "Alliance name",
    addAlliance: "Add Alliance",
    selectAlliance: "-- Select Alliance --",
    facilitySummary: "Facility Summary",
    buffSummary: "Buff Summary",
    exportCsv: "Export CSV",
    exportPng: "Export PNG",
    details: "Details",
    
    // Table headers
    type: "Type",
    level: "Level",
    position: "Position",
    alliance: "Alliance",
    assigned: "assigned",
    
    // Facility types
    Construction: "Construction",
    Production: "Production",
    Defense: "Defense",
    Gathering: "Gathering",
    Tech: "Tech",
    Weapons: "Weapons",
    Training: "Training",
    Expedition: "Expedition",
    Stronghold: "Stronghold",
    Fortress: "Fortress",
    
    // Messages
    maxAlliances: "Max 100 alliances or missing name",
    addAllianceFirst: "⚠️ Add at least one alliance before assigning.",
    duplicates: "⚠️ Duplicates:",
    
    // Alliance management
    editAlliance: "Edit",
    deleteAlliance: "Delete",
    updateAlliance: "Update",
    confirmDelete: "Are you sure you want to delete",
    warningAssigned: "Warning: This alliance is assigned to",
    facilities: "facilities",
    assignmentsWillBeRemoved: "These assignments will be removed",
    cancel: "Cancel",
    showOnlyAssigned: "Show only assigned",
    
    // Languages
    language: "Language"
  },
  
  it: {
    // Main interface
    title: "Whiteout Survival Companion",
    alliances: "Alleanze",
    allianceName: "Nome alleanza",
    addAlliance: "Aggiungi Alleanza",
    selectAlliance: "-- Seleziona Alleanza --",
    facilitySummary: "Riepilogo Strutture",
    buffSummary: "Riepilogo Buff",
    exportCsv: "Esporta CSV",
    exportPng: "Esporta PNG",
    details: "Dettagli",
    
    // Table headers
    type: "Tipo",
    level: "Livello", 
    position: "Posizione",
    alliance: "Alleanza",
    assigned: "assegnate",
    
    // Facility types
    Construction: "Costruzione",
    Production: "Produzione",
    Defense: "Difesa",
    Gathering: "Raccolta",
    Tech: "Tecnologia",
    Weapons: "Armi",
    Training: "Addestramento",
    Expedition: "Spedizione",
    Stronghold: "Fortezza",
    Fortress: "Roccaforte",
    
    // Messages
    maxAlliances: "Massimo 100 alleanze o nome mancante",
    addAllianceFirst: "⚠️ Aggiungi almeno un'alleanza prima di assegnare.",
    duplicates: "⚠️ Duplicati:",
    
    // Alliance management
    editAlliance: "Modifica",
    deleteAlliance: "Elimina",
    updateAlliance: "Aggiorna",
    confirmDelete: "Sei sicuro di voler eliminare",
    warningAssigned: "Attenzione: Questa alleanza è assegnata a",
    facilities: "strutture",
    assignmentsWillBeRemoved: "Queste assegnazioni verranno rimosse",
    cancel: "Annulla",
    showOnlyAssigned: "Mostra solo assegnate",
    
    // Languages
    language: "Lingua"
  },
  
  fr: {
    // Main interface
    title: "Whiteout Survival Companion",
    alliances: "Alliances",
    allianceName: "Nom de l'alliance",
    addAlliance: "Ajouter Alliance",
    selectAlliance: "-- Sélectionner Alliance --",
    facilitySummary: "Résumé des Installations",
    buffSummary: "Résumé des Bonus",
    exportCsv: "Exporter CSV",
    details: "Détails",
    
    // Table headers
    type: "Type",
    level: "Niveau",
    position: "Position",
    alliance: "Alliance",
    assigned: "assignées",
    
    // Facility types
    Construction: "Construction",
    Production: "Production",
    Defense: "Défense",
    Gathering: "Collecte",
    Tech: "Technologie",
    Weapons: "Armes",
    Training: "Entraînement",
    Expedition: "Expédition",
    Stronghold: "Bastion",
    Fortress: "Forteresse",
    
    // Messages
    maxAlliances: "Maximum 100 alliances ou nom manquant",
    addAllianceFirst: "⚠️ Ajoutez au moins une alliance avant d'assigner.",
    duplicates: "⚠️ Doublons:",
    
    // Alliance management
    editAlliance: "Modifier",
    deleteAlliance: "Supprimer",
    updateAlliance: "Mettre à jour",
    confirmDelete: "Êtes-vous sûr de vouloir supprimer",
    warningAssigned: "Attention: Cette alliance est assignée à",
    facilities: "installations",
    assignmentsWillBeRemoved: "Ces assignations seront supprimées",
    cancel: "Annuler",
    showOnlyAssigned: "Afficher seulement assignées",
    
    // Languages
    language: "Langue"
  },
  
  de: {
    // Main interface
    title: "Whiteout Survival Companion",
    alliances: "Allianzen",
    allianceName: "Allianzname",
    addAlliance: "Allianz hinzufügen",
    selectAlliance: "-- Allianz auswählen --",
    facilitySummary: "Anlagen-Übersicht",
    buffSummary: "Buff-Übersicht",
    exportCsv: "CSV exportieren",
    details: "Details",
    
    // Table headers
    type: "Typ",
    level: "Level",
    position: "Position",
    alliance: "Allianz",
    assigned: "zugewiesen",
    
    // Facility types
    Construction: "Konstruktion",
    Production: "Produktion",
    Defense: "Verteidigung",
    Gathering: "Sammlung",
    Tech: "Technologie",
    Weapons: "Waffen",
    Training: "Training",
    Expedition: "Expedition",
    Stronghold: "Festung",
    Fortress: "Burg",
    
    // Messages
    maxAlliances: "Maximal 100 Allianzen oder Name fehlt",
    addAllianceFirst: "⚠️ Fügen Sie mindestens eine Allianz hinzu, bevor Sie zuweisen.",
    duplicates: "⚠️ Duplikate:",
    
    // Alliance management
    editAlliance: "Bearbeiten",
    deleteAlliance: "Löschen",
    updateAlliance: "Aktualisieren",
    confirmDelete: "Sind Sie sicher, dass Sie löschen möchten",
    warningAssigned: "Warnung: Diese Allianz ist zugewiesen zu",
    facilities: "Anlagen",
    assignmentsWillBeRemoved: "Diese Zuweisungen werden entfernt",
    cancel: "Abbrechen",
    showOnlyAssigned: "Nur zugewiesene anzeigen",
    
    // Languages
    language: "Sprache"
  },
  
  es: {
    // Main interface
    title: "Whiteout Survival Companion",
    alliances: "Alianzas",
    allianceName: "Nombre de alianza",
    addAlliance: "Añadir Alianza",
    selectAlliance: "-- Seleccionar Alianza --",
    facilitySummary: "Resumen de Instalaciones",
    buffSummary: "Resumen de Buffs",
    exportCsv: "Exportar CSV",
    details: "Detalles",
    
    // Table headers
    type: "Tipo",
    level: "Nivel",
    position: "Posición",
    alliance: "Alianza",
    assigned: "asignadas",
    
    // Facility types
    Construction: "Construcción",
    Production: "Producción",
    Defense: "Defensa",
    Gathering: "Recolección",
    Tech: "Tecnología",
    Weapons: "Armas",
    Training: "Entrenamiento",
    Expedition: "Expedición",
    Stronghold: "Fortaleza",
    Fortress: "Ciudadela",
    
    // Messages
    maxAlliances: "Máximo 100 alianzas o falta nombre",
    addAllianceFirst: "⚠️ Añade al menos una alianza antes de asignar.",
    duplicates: "⚠️ Duplicados:",
    
    // Alliance management
    editAlliance: "Editar",
    deleteAlliance: "Eliminar",
    updateAlliance: "Actualizar",
    confirmDelete: "¿Estás seguro de que quieres eliminar",
    warningAssigned: "Advertencia: Esta alianza está asignada a",
    facilities: "instalaciones",
    assignmentsWillBeRemoved: "Estas asignaciones serán eliminadas",
    cancel: "Cancelar",
    showOnlyAssigned: "Mostrar solo asignadas",
    
    // Languages
    language: "Idioma"
  },
  
  pt: {
    // Main interface
    title: "Whiteout Survival Companion",
    alliances: "Alianças",
    allianceName: "Nome da aliança",
    addAlliance: "Adicionar Aliança",
    selectAlliance: "-- Selecionar Aliança --",
    facilitySummary: "Resumo de Instalações",
    buffSummary: "Resumo de Buffs",
    exportCsv: "Exportar CSV",
    details: "Detalhes",
    
    // Table headers
    type: "Tipo",
    level: "Nível",
    position: "Posição",
    alliance: "Aliança",
    assigned: "atribuídas",
    
    // Facility types
    Construction: "Construção",
    Production: "Produção",
    Defense: "Defesa",
    Gathering: "Coleta",
    Tech: "Tecnologia",
    Weapons: "Armas",
    Training: "Treinamento",
    Expedition: "Expedição",
    Stronghold: "Fortaleza",
    Fortress: "Cidadela",
    
    // Messages
    maxAlliances: "Máximo 100 alianças ou nome em falta",
    addAllianceFirst: "⚠️ Adicione pelo menos uma aliança antes de atribuir.",
    duplicates: "⚠️ Duplicados:",
    
    // Alliance management
    editAlliance: "Editar",
    deleteAlliance: "Eliminar",
    updateAlliance: "Atualizar",
    confirmDelete: "Tem certeza de que quer eliminar",
    warningAssigned: "Aviso: Esta aliança está atribuída a",
    facilities: "instalações",
    assignmentsWillBeRemoved: "Estas atribuições serão removidas",
    cancel: "Cancelar",
    showOnlyAssigned: "Mostrar apenas atribuídas",
    
    // Languages
    language: "Idioma"
  },
  
  "zh-CN": {
    // Main interface
    title: "白色生存伴侣",
    alliances: "联盟",
    allianceName: "联盟名称",
    addAlliance: "添加联盟",
    selectAlliance: "-- 选择联盟 --",
    facilitySummary: "设施摘要",
    buffSummary: "增益摘要",
    exportCsv: "导出 CSV",
    details: "详情",
    
    // Table headers
    type: "类型",
    level: "等级",
    position: "位置",
    alliance: "联盟",
    assigned: "已分配",
    
    // Facility types
    Construction: "建筑",
    Production: "生产",
    Defense: "防御",
    Gathering: "采集",
    Tech: "科技",
    Weapons: "武器",
    Training: "训练",
    Expedition: "远征",
    Stronghold: "要塞",
    Fortress: "堡垒",
    
    // Messages
    maxAlliances: "最多100个联盟或缺少名称",
    addAllianceFirst: "⚠️ 分配前请先添加至少一个联盟。",
    duplicates: "⚠️ 重复:",
    
    // Alliance management
    editAlliance: "编辑",
    deleteAlliance: "删除",
    updateAlliance: "更新",
    confirmDelete: "您确定要删除",
    warningAssigned: "警告：此联盟已分配给",
    facilities: "设施",
    assignmentsWillBeRemoved: "这些分配将被删除",
    cancel: "取消",
    showOnlyAssigned: "仅显示已分配",
    
    // Languages
    language: "语言"
  },
  
  ko: {
    // Main interface
    title: "화이트아웃 서바이벌 컴패니언",
    alliances: "연합",
    allianceName: "연합 이름",
    addAlliance: "연합 추가",
    selectAlliance: "-- 연합 선택 --",
    facilitySummary: "시설 요약",
    buffSummary: "버프 요약",
    exportCsv: "CSV 내보내기",
    details: "세부사항",
    
    // Table headers
    type: "유형",
    level: "레벨",
    position: "위치",
    alliance: "연합",
    assigned: "할당됨",
    
    // Facility types
    Construction: "건설",
    Production: "생산",
    Defense: "방어",
    Gathering: "수집",
    Tech: "기술",
    Weapons: "무기",
    Training: "훈련",
    Expedition: "원정",
    Stronghold: "요새",
    Fortress: "성채",
    
    // Messages
    maxAlliances: "최대 100개 연합 또는 이름 누락",
    addAllianceFirst: "⚠️ 할당하기 전에 최소한 하나의 연합을 추가하세요.",
    duplicates: "⚠️ 중복:",
    
    // Alliance management
    editAlliance: "편집",
    deleteAlliance: "삭제",
    updateAlliance: "업데이트",
    confirmDelete: "정말로 삭제하시겠습니까",
    warningAssigned: "경고: 이 연합이 할당된 대상",
    facilities: "시설",
    assignmentsWillBeRemoved: "이러한 할당이 제거됩니다",
    cancel: "취소",
    showOnlyAssigned: "할당된 것만 표시",
    
    // Languages
    language: "언어"
  },
  
  ja: {
    // Main interface
    title: "ホワイトアウト サバイバル コンパニオン",
    alliances: "アライアンス",
    allianceName: "アライアンス名",
    addAlliance: "アライアンス追加",
    selectAlliance: "-- アライアンス選択 --",
    facilitySummary: "施設概要",
    buffSummary: "バフ概要",
    exportCsv: "CSV エクスポート",
    details: "詳細",
    
    // Table headers
    type: "タイプ",
    level: "レベル",
    position: "位置",
    alliance: "アライアンス",
    assigned: "割り当て済み",
    
    // Facility types
    Construction: "建設",
    Production: "生産",
    Defense: "防御",
    Gathering: "収集",
    Tech: "技術",
    Weapons: "武器",
    Training: "訓練",
    Expedition: "遠征",
    Stronghold: "要塞",
    Fortress: "城塞",
    
    // Messages
    maxAlliances: "最大100アライアンスまたは名前が不足",
    addAllianceFirst: "⚠️ 割り当て前に少なくとも1つのアライアンスを追加してください。",
    duplicates: "⚠️ 重複:",
    
    // Alliance management
    editAlliance: "編集",
    deleteAlliance: "削除",
    updateAlliance: "更新",
    confirmDelete: "本当に削除しますか",
    warningAssigned: "警告：このアライアンスは割り当てられています",
    facilities: "施設",
    assignmentsWillBeRemoved: "これらの割り当てが削除されます",
    cancel: "キャンセル",
    showOnlyAssigned: "割り当て済みのみ表示",
    
    // Languages
    language: "言語"
  },
  
  ru: {
    // Main interface
    title: "Whiteout Survival Компаньон",
    alliances: "Альянсы",
    allianceName: "Название альянса",
    addAlliance: "Добавить Альянс",
    selectAlliance: "-- Выбрать Альянс --",
    facilitySummary: "Сводка Объектов",
    buffSummary: "Сводка Баффов",
    exportCsv: "Экспорт CSV",
    details: "Детали",
    
    // Table headers
    type: "Тип",
    level: "Уровень",
    position: "Позиция",
    alliance: "Альянс",
    assigned: "назначено",
    
    // Facility types
    Construction: "Строительство",
    Production: "Производство",
    Defense: "Оборона",
    Gathering: "Сбор",
    Tech: "Технологии",
    Weapons: "Оружие",
    Training: "Обучение",
    Expedition: "Экспедиция",
    Stronghold: "Крепость",
    Fortress: "Форт",
    
    // Messages
    maxAlliances: "Максимум 100 альянсов или отсутствует имя",
    addAllianceFirst: "⚠️ Добавьте хотя бы один альянс перед назначением.",
    duplicates: "⚠️ Дубликаты:",
    
    // Alliance management
    editAlliance: "Редактировать",
    deleteAlliance: "Удалить",
    updateAlliance: "Обновить",
    confirmDelete: "Вы уверены, что хотите удалить",
    warningAssigned: "Предупреждение: Этот альянс назначен",
    facilities: "объектам",
    assignmentsWillBeRemoved: "Эти назначения будут удалены",
    cancel: "Отмена",
    showOnlyAssigned: "Показать только назначенные",
    
    // Languages
    language: "Язык"
  }
};

// Language management
let currentLanguage = 'en';

function setLanguage(lang) {
  currentLanguage = lang;
  localStorage.setItem('whiteout-language', lang);
  updateUI();
}

function t(key) {
  return translations[currentLanguage][key] || translations['en'][key] || key;
}

function initLanguage() {
  const saved = localStorage.getItem('whiteout-language');
  if (saved && translations[saved]) {
    currentLanguage = saved;
  } else {
    // Auto-detect browser language as fallback
    const browserLang = navigator.language || navigator.userLanguage;
    // Try exact match first (e.g., 'en-US' or 'zh-CN')
    if (translations[browserLang]) {
      currentLanguage = browserLang;
    } else {
      // Try language code only (e.g., 'en' from 'en-US')
      const langCode = browserLang.split('-')[0];
      if (translations[langCode]) {
        currentLanguage = langCode;
      }
      // If no match, keep default 'en'
    }
  }
  
  const selector = document.getElementById('language-selector');
  if (selector) {
    selector.innerHTML = Object.keys(translations).map(lang => {
      const names = {
        'en': 'English',
        'it': 'Italiano', 
        'fr': 'Français',
        'de': 'Deutsch',
        'es': 'Español',
        'pt': 'Português',
        'zh-CN': '中文 (简体)',
        'ko': '한국어',
        'ja': '日本語',
        'ru': 'Русский'
      };
      return `<option value="${lang}" ${lang === currentLanguage ? 'selected' : ''}>${names[lang]}</option>`;
    }).join('');
    
    selector.addEventListener('change', (e) => {
      setLanguage(e.target.value);
    });
  }
}

function updateUI() {
  // Update all elements with data-i18n attributes
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    el.textContent = t(key);
  });
  
  // Update dynamic placeholders via data-i18n-placeholder
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    el.placeholder = t(key);
  });
  
  // Special handling for buttons that might be in editing mode
  const addButton = document.querySelector('#alliance-form button[type="submit"]');
  if (addButton && !addButton.classList.contains('editing')) {
    addButton.textContent = t('addAlliance');
  }
  
  // Re-render dynamic content
  if (typeof renderAllianceList === 'function') renderAllianceList();
  if (typeof renderFacilitySummary === 'function') renderFacilitySummary();
  if (typeof renderBuffSummary === 'function') renderBuffSummary();
}